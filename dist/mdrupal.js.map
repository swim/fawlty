{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","build.js","core/class/request.js","core/class/rest.js","core/queue.js","core/request.js"],"names":[],"mappings":"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","file":"mdrupal.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\n * @file\n * build.js\n */\n\nvar mdrupal = {\n  user: {\n    token: m.prop(false)\n  },\n  request: require('./core/request.js'),\n  queue: require('./core/queue.js')\n}\n\nmodule.exports = mdrupal;","/**\n * @file\n * request.js\n *\n * m.request class wrapper for Drupal requests.\n */\n\nclass Request {\n  constructor(options) {\n    this.response = [];\n    this.cache = [];\n    this.completed = m.prop(false);\n\n    // Default settings\n    this.settings = options.settings ? options.settings : {};\n    this.settings.redrawTimeout = options.settings.redrawTimeout ? options.settings.redrawTimeout : 0;\n    this.settings.redrawPerQueue = options.settings.redrawPerQueue ? options.settings.redrawPerQueue : false;\n    this.settings.basePath = options.settings.basePath ? options.settings.basePath : '';\n\n    // Request params\n    this.params = options.data;\n    this.params.url = this.settings.basePath + this.params.url;\n\n    this.init();\n  }\n\n  init() {\n    this.process();\n  }\n\n  process() {\n    this.cacheIndex(this.params.url, this.params.data);\n\n    if (!this.cache[this.index]) {\n      var background = this.params.background ? true : false;\n      var timeout = this.settings.redrawTimeout;\n\n      this.cache[this.index] = {\n        data: m.request(this.params).then(this.success.bind(this), this.error.bind(this)).then(function(response) {\n          if (background) {\n            // (virtual) DOM renders too quick.\n            // Set minimum wait time for redraw.\n            setTimeout(function() {\n              m.redraw()\n            }, timeout)\n          }\n\n          return response;\n        }),\n        status: this.completed\n      };\n    }\n\n    this.response = this.cache[this.index];\n  }\n\n  success(response) {\n    this.completed(true)\n\n    delete this.cache[this.index];\n    return response;\n  }\n\n  error(response) {\n    delete this.cache[this.index];\n    return response;\n  }\n\n  cacheIndex(url, data) {\n    this.index = JSON.stringify({url: url, query: data});\n  }\n}\n\nmodule.exports = Request;","/**\n * @file\n * rest.js\n *\n * Format request params for Drupal REST to parse.\n *\n * @todo, allow option to set auth type used.\n * @todo, improve request error handling.\n */\nimport Request from './request';\n\nclass Rest extends Request {\n  init() {\n    // Set REST defaults\n    var format = this.settings.format ? this.settings.format : 'json';\n    this.params.url += '?_format=' + format;\n\n    // Set request headers.\n    this.requestHeaders();\n\n    // Handle malformed response.\n    this.requestExtract();\n\n    // Process request.\n    super.process();\n  }\n\n  requestHeaders() {\n    var headers = this.settings.headers ? this.settings.headers : [];\n\n    if (!this.params.config) {\n      this.params.config = function(xhr) {\n        for (var i = 0; i < headers.length; i++) {\n          xhr.setRequestHeader(headers[i].type, headers[i].value);\n        }\n\n        // Set CSRF token, if available.\n        if (md.user.token()) {\n          xhr.setRequestHeader('X-CSRF-Token', md.user.token());\n        }\n      }\n    }\n  }\n\n  requestExtract() {\n    if (!this.params.extract) {\n      this.params.extract = function(xhr, xhrOptions) {\n        try {\n          if (xhr.status == 404) {\n            throw JSON.parse(xhr.response); \n          }\n  \n          return xhr.response;\n        }\n        catch (e) {\n          throw new Error(e.message)\n        }\n      }\n    }\n  }\n}\n\nmodule.exports = Rest;","/**\n * @file\n * queue.js\n *\n * Provides util functionality for queuing requests.\n *\n * @todo, provide easy entity loading; prefil values.\n * @todo, support per request options; currently per queue.\n */\nvar request = require('./request.js');\n\nvar queue = (function() {\n  var vm = {};\n\n  vm.queue = function(requests, options) {\n    var response = [];\n\n    for (var i = 0; i < requests.length; i++) {\n      response.push(request(requests[i], options));\n    }\n\n    return response;\n  }\n\n  return vm;\n}())\n\nmodule.exports = queue.queue;","/**\n * @file\n * request.js\n *\n * Abstracts the request response.\n */\nimport Rest from './class/rest';\n\nvar request = (function() {\n  var vm = {\n    lock: m.prop(false)\n  };\n\n  vm.request = function(request, options) {\n    var params = {\n      data: request,\n      settings: options ? options : {}\n    };\n\n    // check for CSRF token; otherwise request one.\n    if (!vm.lock() && !md.user.token()) {\n      vm.lock(true)\n\n      new Rest({\n        data: {\n          method: 'GET',\n          url: '/rest/session/token',\n          extract: function(xhr) {\n            var token = xhr.responseText;\n  \n            if (xhr.status == 200) {\n              token = JSON.stringify(xhr.responseText);\n            }\n\n            // Set CSRF token.\n            return md.user.token(token);\n          }\n        },\n        settings: {\n          format: ''\n        }\n      });\n    }\n\n    return new Rest(params).response;\n  }\n\n  return vm;\n}())\n\nmodule.exports = request.request;"]}